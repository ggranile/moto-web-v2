---
import Layout from "@/layouts/Layout.astro";

import MotoBackground from "@/assets/moto-background.png";
import MotoEyes from "@/assets/moto-eyes.png";
import MotoWelcome from "@/assets/moto-welcome.png";
import Menu from "@/assets/menu.svg";
---

<Layout>
  <div class="scroll-container"></div>

  <section id="content" class="fixed inset-0 bg-black text-neutral-100 z-10 min-h-screen ">
    <div class="mx-auto max-w-3xl p-8 w-full text-center h-full flex flex-col justify-center">
    <img src="/rock_01.png" alt="img1"
      class="absolute top-10 left-10 w-24 pointer-events-none"
      style="animation: float 6s ease-in-out infinite;" />
    </div>
  </section>

  <section id="after" class="relative bg-[#33383b] text-neutral-100 min-h-screen flex items-center justify-center z-20">
    <div class="mx-auto max-w-3xl p-8 w-full text-center">
      <h2 class="text-3xl font-semibold mb-4">Nueva Secci√≥n</h2>
      <p class="text-lg opacity-90">Contenido adicional que aparece al terminar la intro.</p>
    </div>
  </section>

  <section id="intro" class="fixed inset-0 h-screen overflow-hidden z-20">
    <div id="light-background" class="absolute inset-0 bg-[#e4e7e9] z-5 opacity-0"></div>
    <div id="logo-mask" class="absolute w-full h-full">
      <picture id="moto" class="absolute h-full scale-112 block overflow-hidden">
        <img id="moto-background" src={MotoBackground.src} class="w-full h-full object-cover" />
      </picture>
    </div>
    <div id="outside-black" class="absolute inset-0 pointer-events-none z-20"></div>
    <img id="eyes" src={MotoEyes.src} alt="eyes" class="absolute left-1/2 top-[11.5%] -translate-x-1/2 pointer-events-none z-20 w-[clamp(20vh,20%,25vh)]" />
    <img id="moto-welcome" class="mask-fade-b absolute left-1/2 top-[40%] -translate-x-1/2 z-20 w-[min(90vw,800px)]" src={MotoWelcome.src} alt="Welcome" />
    <div class="absolute flex flex-col items-center justify-between p-8 w-full z-20">
      <header class="flex justify-end w-full">
        <Menu class="size-14 text-rose-300" />
      </header>
      <footer id="moto-footer" class="absolute bottom-0 m-auto" />
    </div>
  </section>

</Layout>

<style>

  #content, #after, #intro { will-change: transform; }

  #logo-mask {
    background: black;
    mask-image: url("/moto-logo-mask.svg");
    mask-type: luminance;
    mask-position: center 28%;
    mask-repeat: no-repeat;
    mask-size: clamp(5150vh, 3500%, 0vh);
  }

  #outside-black {
    background: #32383b;
    mask-image: linear-gradient(#fff 0 0), url("/moto-logo-mask.svg");
    mask-repeat: no-repeat, no-repeat;
    mask-position: center, center 28%;
    mask-size: 100% 100%, clamp(5150vh, 3500%, 0vh);
    mask-composite: exclude;
  }

  #moto-welcome{
    --reveal: 0%;
    --feather: 28%;
    mask-image: linear-gradient(
      to top,
      black 0%,
      black var(--reveal),
      transparent calc(var(--reveal) + var(--feather))
    );
  }

  .scroll-container {
    height: 250vh;
    position: relative;
  }

  @keyframes float {
  0%,100% { transform: translateY(0); }
  50%     { transform: translateY(-20px); }
}
@keyframes float2 {
  0%,100% { transform: translateY(0) rotate(0deg); }
  50%     { transform: translateY(-14px) rotate(2deg); }
}

</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  const tl = gsap.timeline({ ease: "power2.out" });

  tl.to("#moto", { duration: 0.8, scale: 1 })
    .to("#logo-mask", { maskSize: "clamp(20vh, 25%, 30vh)" }, 0.10)
    .to("#outside-black", { maskSize: "100% 100%, clamp(20vh, 25%, 30vh)" }, 0.10)
    .to("#light-background", { opacity: 1, duration: 0.4 }, 0.4)
    .to("#logo-mask", { opacity: 0, duration: 0.2 }, 0.5)
    .fromTo("#eyes", { opacity: 0, y: -15 }, { opacity: 1, y: 0, duration: 0.35 }, ">-0.1")
    .fromTo("#moto-welcome", { opacity: 0, "--reveal": "0%" }, { opacity: 1, "--reveal": "100%", duration: 0.5, ease: "power3.out" }, ">-0.1")
    .to("#intro", { yPercent: -100, ease: "none", duration: 1 }, ">")
    .set("#after", { y: 100 })
    .to("#after", { y: 0, duration: 0.1, ease: "power2.out" }, "<"); // entra after desde abajo en paralelo


  ScrollTrigger.create({
    trigger: ".scroll-container",
    start: "top top",
    end: "bottom bottom",
    scrub: 1,
    animation: tl,
    invalidateOnRefresh: true,
  });
</script>